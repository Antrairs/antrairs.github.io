var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,c=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&o(e,r,t[r]);if(s)for(var r of s(t))n.call(t,r)&&o(e,r,t[r]);return e},l=(e,s)=>t(e,r(s)),i=(e,t,r)=>new Promise(((s,a)=>{var n=e=>{try{c(r.next(e))}catch(t){a(t)}},o=e=>{try{c(r.throw(e))}catch(t){a(t)}},c=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,o);c((r=r.apply(e,t)).next())}));import{f as d,g as u,l as m,V as h,T as p,L as f,C as g,m as b,I as x,B as j,o as y}from"./vendors.8d5e5efc.js";function v(){const[e,t]=d.useState(""),[r,s]=d.useState([]),[a,n]=d.useState(!1),o=d.useRef(null),v=d.useRef(null);u((()=>{console.log("Oracle Multimodal Generation Page loaded.")}));const w=e=>{t(e.target.value)},O=()=>{var e;null==(e=v.current)||e.scrollIntoView({behavior:"smooth"})};d.useEffect((()=>{O()}),[r]);const N=()=>i(this,null,(function*(){if(!e.trim())return void y.warning("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01");const a={role:"user",content:e};s((e=>[...e,a])),t(""),n(!0),o.current=new AbortController;const i=o.current.signal;try{const t=yield fetch("https://llm.chutes.ai/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer cpk_0b45ae9eb7a14cb693a8c975a4afe68c.187ffd27e61b5110960fa15885549cf5.tcsxlORoGZR1BrWeLDJdJ5Ji2rzswbvv","Content-Type":"application/json"},body:JSON.stringify({model:"deepseek-ai/DeepSeek-V3-0324",messages:[...r,{role:"user",content:e}],stream:!0,max_tokens:1024,temperature:.7}),signal:i});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=t.body.getReader(),n=new TextDecoder("utf-8");let o="";while(1){const{done:e,value:t}=yield a.read();if(e)break;o+=n.decode(t,{stream:!0});const r=o.split("\n");o=r.pop();for(const a of r)if(a.startsWith("data: "))try{const e=JSON.parse(a.substring(6));e.choices&&e.choices[0]&&e.choices[0].delta&&e.choices[0].delta.content&&s((t=>{const r=t[t.length-1];return r&&"assistant"===r.role?t.map(((r,s)=>s===t.length-1?l(c({},r),{content:r.content+e.choices[0].delta.content}):r)):[...t,{role:"assistant",content:e.choices[0].delta.content}]}))}catch(d){console.error("Error parsing JSON:",d,"Line:",a)}}}catch(u){"AbortError"===u.name?console.log("Fetch aborted"):(console.error("Fetch error:",u),s((e=>[...e,{role:"assistant",content:`Error: ${u.message}`}])))}finally{n(!1),o.current=null}})),P=()=>{o.current&&o.current.abort()};return m.jsxs(h,{className:"oracle-multimodal-generation",children:[m.jsx(p,{className:"title",children:"\u7532\u9aa8\u6587\u591a\u6a21\u6001\u751f\u6210"}),m.jsxs(h,{className:"message-list-container",children:[m.jsx(f,{dataSource:r,renderItem:(e,t)=>m.jsx(f.Item,{className:`message-item-container ${e.role}`,children:m.jsx(g,{className:`message-card ${e.role}`,children:m.jsx(p,{className:"message-content",children:e.content})})},t)}),a&&m.jsxs(h,{className:"loading-indicator",children:[m.jsx(b,{size:"large"}),m.jsx(p,{className:"loading-text",children:"\u52a0\u8f7d\u4e2d..."})]}),m.jsx(h,{ref:v})]}),m.jsxs(h,{className:"input-area",children:[m.jsx(x.TextArea,{value:e,onChange:w,onPressEnter:e=>{e.shiftKey||(e.preventDefault(),N())},placeholder:"\u8bf7\u8f93\u5165\u60a8\u7684\u95ee\u9898...",autoSize:{minRows:1,maxRows:4},className:"input-text-area"}),m.jsxs(h,{className:"button-group",children:[m.jsx(j,{type:"primary",onClick:N,loading:a,disabled:a||!e.trim(),children:"\u53d1\u9001"}),m.jsx(j,{onClick:P,disabled:!a,children:"\u53d6\u6d88"})]})]})]})}export{v as default};
